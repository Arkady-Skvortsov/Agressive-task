# Agressive-task

# Description
That's pipeline need's for Nx monorepository (In current case: Angular/NestJS)

***This pipeline makes you'r life hell like a contributor ðŸ”¥ðŸ”¥ðŸ”¥***

<p style="{position: center}"><img src="https://graphicriver.img.customer.envatousercontent.com/files/357821315/preview.jpg?auto=compress%2Cformat&fit=crop&crop=top&w=590&h=590&s=2650bc1547a78fe5aaa214eb9291700b" /></p>

`.github/workflows`

name: 'Main branch CI/CD'

on:
  pull_request:
    branches: [main]

jobs:
  build:
  
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [10.x, 12.x, 14.x, 15.x, 16.x]

    steps:
      - name: 'Actions checkout'
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}
          fetch-depth: 0
          
      - name: Derive appropriate SHAs for base and head for `nx affected` commands
        uses: nrwl/nx-set-shas@v2
 
      - name: 'Use Node.js ${{ matrix.node-version }}'
        uses: actions/setup-node@v2
      - name: 'Install dependencies'
      - run: npm install
      
      - run: npx nx affected --target=build --parallel --max-parallel=3
      - run: npx nx affected --target=test --parallel --max-parallel=2
      
      - name: 'Cache multiple paths'
        uses: actions/cache@v2
        with:
          path: |
            ~/cache
            !~/cache/exclude
            key: ${{ runner.os }}-${{ hashFiles('**/lockfiles') }}
            
      - name: 'Run CI process'
      - run: npm ci
      
      - name: 'Run ESLint rules checkout'
        run: npm run affected:lint

      - name: 'Run Prettier rules checkout'
        uses: creyD/prettier_action@v4.2
        with:
          prettier_options: --config .prettierrc apps/**/*.ts --no-editorconfig --check
          only_changed: True
          
      - name: 'Jest test coverage controll'
      - uses: mattallty/jest-github-action@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          threshold: 80
        with:
          changes-only: true
          
      - name: 'Run Unit tests'
      - run: npm run affected:test
      
      - name: 'Run E2E tests'
      - run: npm run affected:test:e2e
      
      - name: 'Run Cypress tests'
      - run: npm run affected:cypress
      
      - name: 'Cypress test coverage'
      - run: npm run cypress:coverage

      - name: 'Run Mutants genocide process (Stryker mutation testing for Cypress/Jest)'
      - run: npm run start:alien:genocide

      - name: 'Build the project'
      - run: npm run build --if-present

      - name: 'Create Pull Request'
        id: cpr
        uses: peter-evans/create-pull-request@v3
        with:
          token: ${{ secrets.PAT }}
          commit-message: ${{ github.event.head_commit.message }}
          committer: ${{ github.event.pusher.name }}
          author: ${{ github.actor }} <${{ github.actor }}@users.noreply.github.com>
          signoff: false
          branch: main
          delete-branch: true
          title: ${{ github.event.head_commit.message }}
          body: |
            Update report
            - Updated with *today's* date
            - Auto-generated by [You'r Repo][1]
            
            [1]: Path to you'r repository
          labels: |
            report
            automated pr
          assignees: SomeUser
          reviewers: SomeUser
          team-reviewers: |
            owners
            maintainers
          run: |
            echo "The name of contributor - ${{ github.event.pusher.name }}"
            echo "Commit message/title is - ${{ github.event.head_commit.message }}"
            echo "Author is ${{ github.actor }}"
          milestone: 1
          draft: false
